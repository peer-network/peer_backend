{
  "info": {
    "_postman_id": "7a2d6e50-0bf3-4a57-9b64-8a2c579d887c",
    "name": "003_wallet_graphql",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "43606001",
    "_collection_link": "https://go.postman.co/collection/43606001-7a2d6e50-0bf3-4a57-9b64-8a2c579d887c?source=collection_link"
  },
  "item": [
    {
      "name": "Hello",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Null is in there\", function () {",
              "    let responseJson = pm.response.json();",
              "    pm.expect(responseJson.data.hello.currentuserid).to.eql(\"\");",
              "});",
              "",
              "pm.test(\"Save companyAccountId as referralUuid\", function () {",
              "    const response = pm.response.json();",
              "    const id = response.data?.hello?.companyAccountId;",
              "",
              "    pm.expect(id, \"companyAccountId should exist\").to.be.a(\"string\").that.is.not.empty;",
              "",
              "    pm.environment.set(\"referralUuid\", id);",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query Hello {\n    hello {\n        currentuserid\n        currentVersion\n        wikiLink\n        lastMergedPullRequestNumber\n        companyAccountId\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Registration",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"10601\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "pm.environment.set(\"userid\", response.data.register.userid);",
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "// generate random email",
              "let randomEmail = `user_${Math.floor(Math.random() * 1000000)}@example.com`;",
              "",
              "// save",
              "pm.environment.set(\"random_email\", randomEmail);"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation {\n  register(input: {\n    email: \"{{random_email}}\",\n    password: \"{{password}}\",\n    username: \"{{username}}\",\n    referralUuid: \"{{w_userid_t2}}\"\n  }) {\n    meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n    userid\n  }\n}",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Verification",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"10701\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation VerifiedAccount {\n    verifyAccount(userid: \"{{userid}}\") {\n        status\n        RequestId\n        ResponseCode\n        ResponseMessage\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Login tester 2",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"10801\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "if (!pm.response.text().includes(\"error\")) {",
              "    pm.environment.set(\"accessToken\", response.data.login.accessToken);",
              "} else {",
              "    console.log(\"Error detected in response, environment variable not set.\");",
              "}",
              "if (!pm.response.text().includes(\"error\")) {",
              "    pm.environment.set(\"refreshToken\", response.data.login.refreshToken);",
              "} else {",
              "    console.log(\"Error detected in response, environment variable not set.\");",
              "}",
              "let token = pm.environment.get(\"accessToken\");",
              "pm.test(\"Access token exists\", function () {",
              "    pm.expect(token).to.be.a(\"string\");",
              "});",
              "",
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation {\n  login(email: \"{{w_email_t2}}\",\n    password: \"{{w_password_t2}}\"\n  ) {\n    meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n    accessToken\n    refreshToken\n  }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Check current liquidity",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11204\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "let liquidity = response.data.balance.currentliquidity;",
              "pm.environment.set(\"liquidity\", liquidity);",
              "console.log(\"Saved liquidity:\", liquidity);"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query Balance {\n    balance {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        currentliquidity\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer token",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11211\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "const json = pm.response.json();",
              "",
              "const tokenAmount =",
              "    json?.data?.resolveTransferV2?.affectedRows?.tokensSubstractedFromWallet;",
              "",
              "pm.test(\"tokensSubstractedFromWallet exists\", () => {",
              "    pm.expect(tokenAmount).to.not.be.undefined;",
              "    pm.expect(tokenAmount).to.not.be.null;",
              "});",
              "",
              "pm.environment.set(\"tokenamount\", Number(tokenAmount));",
              "",
              "console.log(\"tokenamount set to:\", tokenAmount);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{userid}}\", numberoftokens: 160, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Check current liquidity",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11204\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "let newLiquidity = response.data.balance.currentliquidity;",
              "let oldLiquidity = parseFloat(pm.environment.get(\"liquidity\"));",
              "pm.test(\"Previous liquidity exists\", function () {",
              "    pm.expect(oldLiquidity).to.be.a(\"number\");",
              "});",
              "let expectedDecrease = 164.8;",
              "let actualDecrease = oldLiquidity - newLiquidity;",
              "let tolerance = 0.1;",
              "pm.test(`Liquidity should decrease by approximately ${expectedDecrease} Â±${tolerance}`, function () {",
              "    pm.expect(actualDecrease).to.be.within(expectedDecrease - tolerance, expectedDecrease + tolerance);",
              "});",
              "pm.environment.set(\"liquidity\", newLiquidity);",
              "console.log(`Old Liquidity: ${oldLiquidity}, New Liquidity: ${newLiquidity}, Decreased by: ${actualDecrease}`);"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query Balance {\n    balance {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        currentliquidity\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transaction history",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"ResponseCode\":\"11215\"');",
              "});",
              "",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "const json = pm.response.json();",
              "const rows = json?.data?.transactionHistory?.affectedRows ?? [];",
              "",
              "pm.test(\"affectedRows is non-empty array\", () => {",
              "    pm.expect(rows).to.be.an(\"array\").that.is.not.empty;",
              "});",
              "",
              "const txid = rows[0]?.transactionId;",
              "if (txid) {",
              "    pm.environment.set(\"transactionid\", txid);",
              "}",
              "",
              "const opIdsToCheck = rows",
              "    .filter(tx => {",
              "        const token = Number(tx.tokenamount);",
              "",
              "        if (",
              "            (tx.transactionCategory === \"SHOP_PURCHASE\" || tx.transactionCategory === \"P2P_TRANSFER\")",
              "            && token > 0",
              "        ) {",
              "            return false;",
              "        }",
              "",
              "        return true;",
              "    })",
              "    .map(tx => tx.operationid);",
              "",
              "let prevOpIds = pm.environment.get(\"operationid\");",
              "prevOpIds = prevOpIds ? JSON.parse(prevOpIds) : [];",
              "",
              "const duplicates = opIdsToCheck.filter(id => prevOpIds.includes(id));",
              "",
              "pm.test(\"No duplicate operationid from previous request\", () => {",
              "    pm.expect(duplicates.length, `Duplicate operationid found: ${duplicates}`).to.equal(0);",
              "});",
              "",
              "const allOpIds = Array.from(new Set([...prevOpIds, ...opIdsToCheck]));",
              "pm.environment.set(\"operationid\", JSON.stringify(allOpIds));",
              "",
              "const P2P_EXPECTED_TOKEN = Number(pm.environment.get(\"tokenamount\"));",
              "const TOLERANCE = 0.0001;",
              "",
              "function num(v) {",
              "    return Number(v);",
              "}",
              "",
              "function expectNotNull(value, path) {",
              "    pm.expect(",
              "        value !== null && value !== undefined && value !== \"\",",
              "        `${path} is null/empty`",
              "    ).to.be.true;",
              "}",
              "",
              "function expectPercent(actual, base, percent, path) {",
              "    const expected = +(base * percent / 100).toFixed(6);",
              "    pm.expect(",
              "        actual,",
              "        `${path} expected ${percent}% (${expected}), got ${actual}`",
              "    ).to.be.closeTo(expected, TOLERANCE);",
              "}",
              "",
              "rows.forEach((tx, i) => {",
              "    const p = `affectedRows[${i}]`;",
              "",
              "    pm.test(`${p} mandatory fields not null`, () => {",
              "        [",
              "            \"operationid\",",
              "            \"transactionCategory\",",
              "            \"transactiontype\",",
              "            \"tokenamount\",",
              "            \"netTokenAmount\",",
              "            \"createdat\"",
              "        ].forEach(f => expectNotNull(tx[f], `${p}.${f}`));",
              "",
              "        Object.entries(tx.recipient).forEach(([k, v]) => {",
              "            if (k !== \"updatedat\") {",
              "                expectNotNull(v, `${p}.recipient.${k}`);",
              "            }",
              "        });",
              "",
              "        if (tx.transactionCategory !== \"TOKEN_MINT\") {",
              "            Object.entries(tx.sender).forEach(([k, v]) => {",
              "                if (k !== \"updatedat\") {",
              "                    expectNotNull(v, `${p}.sender.${k}`);",
              "                }",
              "            });",
              "        }",
              "",
              "        expectNotNull(tx.fees.total, `${p}.fees.total`);",
              "    });",
              "",
              "    pm.test(`${p} fees calculation`, () => {",
              "        const base = Math.abs(num(tx.netTokenAmount));",
              "",
              "        if (tx.transactionCategory === \"TOKEN_MINT\") {",
              "            pm.expect(num(tx.fees.total)).to.equal(0);",
              "            pm.expect(tx.fees.burn).to.equal(null);",
              "            pm.expect(tx.fees.peer).to.equal(null);",
              "            pm.expect(tx.fees.inviter).to.equal(null);",
              "            return;",
              "        }",
              "",
              "        const hasInviter = tx.fees.inviter !== null;",
              "",
              "        expectPercent(",
              "            num(tx.fees.total),",
              "            base,",
              "            hasInviter ? 4 : 3,",
              "            `${p}.fees.total`",
              "        );",
              "",
              "        expectPercent(num(tx.fees.burn), base, 1, `${p}.fees.burn`);",
              "        expectPercent(num(tx.fees.peer), base, 2, `${p}.fees.peer`);",
              "",
              "        if (hasInviter) {",
              "            expectPercent(",
              "                num(tx.fees.inviter),",
              "                base,",
              "                1,",
              "                `${p}.fees.inviter`",
              "            );",
              "        }",
              "    });",
              "",
              "    pm.test(`${p} tokenamount by transactionCategory`, () => {",
              "        const token = Math.abs(num(tx.tokenamount));",
              "",
              "        switch (tx.transactionCategory) {",
              "            case \"LIKE\":",
              "            case \"DISLIKE\":",
              "                pm.expect(token).to.equal(3);",
              "                break;",
              "",
              "            case \"COMMENT\":",
              "                pm.expect(token).to.equal(1);",
              "                break;",
              "",
              "            case \"AD_PINNED\":",
              "                pm.expect(",
              "                    token === 160 || token % 50 === 0,",
              "                    `${p}.AD_PINNED token invalid: ${token} (expected 160 or multiple of 50)`",
              "                ).to.be.true;",
              "                break;",
              "",
              "            case \"POST_CREATE\":",
              "                pm.expect(token).to.equal(20);",
              "                break;",
              "",
              "            case \"P2P_TRANSFER\":",
              "                pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "                break;",
              "",
              "            case \"SHOP_PURCHASE\":",
              "                pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "                break;",
              "",
              "            case \"TOKEN_MINT\":",
              "                pm.expect(token, `${p}.TOKEN_MINT tokenamount must be > 0`).to.be.above(0);",
              "                pm.expect(",
              "                    num(tx.tokenamount),",
              "                    `${p}.TOKEN_MINT tokenamount must equal netTokenAmount`",
              "                ).to.equal(num(tx.netTokenAmount));",
              "                break;",
              "",
              "            default:",
              "                pm.test(`${p} transactionCategory is known`, () => {",
              "                    pm.expect.fail(`Unhandled transactionCategory: ${tx.transactionCategory}`);",
              "                });",
              "        }",
              "    });",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query TransactionHistory {\n    transactionHistory(limit: 1) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            operationid\n            transactionCategory\n            transactiontype\n            tokenamount\n            netTokenAmount\n            message\n            createdat\n            sender {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            recipient {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            fees {\n                total\n                burn\n                peer\n                inviter\n            }\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get transaction history",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11215\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = {};",
              "try {",
              "    response = pm.response.json();",
              "} catch (e) {",
              "    console.log(\"Failed to parse JSON:\", e);",
              "}",
              "",
              "let transactions = response?.data?.getTransactionHistory?.affectedRows || [];",
              "",
              "let credit = transactions.find(tx => tx.transferaction === \"CREDIT\");",
              "",
              "pm.test(\"CREDIT transaction has correct message\", function () {",
              "    pm.expect(credit).to.not.be.undefined;",
              "    pm.expect(credit.message).to.eql(\"hi\");",
              "    pm.expect(credit?.tokenamount).to.eql(160);",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query GetTransactionHistory {\n    getTransactionHistory(limit: 5) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            transactionid\n            operationid\n            transactiontype\n            senderid\n            recipientid\n            tokenamount\n            transferaction\n            message\n            createdat\n        }\n    }\n}",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer minimum amount",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11211\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "const json = pm.response.json();",
              "",
              "const tokenAmount =",
              "    json?.data?.resolveTransferV2?.affectedRows?.tokensSubstractedFromWallet;",
              "",
              "pm.test(\"tokensSubstractedFromWallet exists\", () => {",
              "    pm.expect(tokenAmount).to.not.be.undefined;",
              "    pm.expect(tokenAmount).to.not.be.null;",
              "});",
              "",
              "pm.environment.set(\"tokenamount\", Number(tokenAmount));",
              "",
              "console.log(\"tokenamount set to:\", tokenAmount);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t1}}\", numberoftokens: 0.000001, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Check current liquidity",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11204\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "let newLiquidity = response.data.balance.currentliquidity;",
              "let oldLiquidity = parseFloat(pm.environment.get(\"liquidity\"));",
              "pm.test(\"Previous liquidity exists\", function () {",
              "    pm.expect(oldLiquidity).to.be.a(\"number\");",
              "});",
              "let expectedDecrease = 0.000001;",
              "let actualDecrease = oldLiquidity - newLiquidity;",
              "let tolerance = 0.00001;",
              "pm.test(`Liquidity should decrease by approximately ${expectedDecrease} Â±${tolerance}`, function () {",
              "    pm.expect(actualDecrease).to.be.within(expectedDecrease - tolerance, expectedDecrease + tolerance);",
              "});",
              "pm.environment.set(\"liquidity\", newLiquidity);",
              "console.log(`Old Liquidity: ${oldLiquidity}, New Liquidity: ${newLiquidity}, Decreased by: ${actualDecrease}`);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query Balance {\n    balance {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        currentliquidity\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transaction history",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"ResponseCode\":\"11215\"');",
              "});",
              "",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "const json = pm.response.json();",
              "const rows = json?.data?.transactionHistory?.affectedRows ?? [];",
              "",
              "pm.test(\"affectedRows is non-empty array\", () => {",
              "    pm.expect(rows).to.be.an(\"array\").that.is.not.empty;",
              "});",
              "",
              "const txid = rows[0]?.transactionId;",
              "if (txid) {",
              "    pm.environment.set(\"transactionid\", txid);",
              "}",
              "",
              "const opIdsToCheck = rows",
              "    .filter(tx => {",
              "        const token = Number(tx.tokenamount);",
              "",
              "        if (",
              "            (tx.transactionCategory === \"SHOP_PURCHASE\" || tx.transactionCategory === \"P2P_TRANSFER\")",
              "            && token > 0",
              "        ) {",
              "            return false;",
              "        }",
              "",
              "        return true;",
              "    })",
              "    .map(tx => tx.operationid);",
              "",
              "let prevOpIds = pm.environment.get(\"operationid\");",
              "prevOpIds = prevOpIds ? JSON.parse(prevOpIds) : [];",
              "",
              "const duplicates = opIdsToCheck.filter(id => prevOpIds.includes(id));",
              "",
              "pm.test(\"No duplicate operationid from previous request\", () => {",
              "    pm.expect(duplicates.length, `Duplicate operationid found: ${duplicates}`).to.equal(0);",
              "});",
              "",
              "const allOpIds = Array.from(new Set([...prevOpIds, ...opIdsToCheck]));",
              "pm.environment.set(\"operationid\", JSON.stringify(allOpIds));",
              "",
              "const P2P_EXPECTED_TOKEN = Number(pm.environment.get(\"tokenamount\"));",
              "const TOLERANCE = 0.0001;",
              "",
              "function num(v) {",
              "    return Number(v);",
              "}",
              "",
              "function expectNotNull(value, path) {",
              "    pm.expect(",
              "        value !== null && value !== undefined && value !== \"\",",
              "        `${path} is null/empty`",
              "    ).to.be.true;",
              "}",
              "",
              "function expectPercent(actual, base, percent, path) {",
              "    const expected = +(base * percent / 100).toFixed(6);",
              "    pm.expect(",
              "        actual,",
              "        `${path} expected ${percent}% (${expected}), got ${actual}`",
              "    ).to.be.closeTo(expected, TOLERANCE);",
              "}",
              "",
              "rows.forEach((tx, i) => {",
              "    const p = `affectedRows[${i}]`;",
              "",
              "    pm.test(`${p} mandatory fields not null`, () => {",
              "        [",
              "            \"operationid\",",
              "            \"transactionCategory\",",
              "            \"transactiontype\",",
              "            \"tokenamount\",",
              "            \"netTokenAmount\",",
              "            \"createdat\"",
              "        ].forEach(f => expectNotNull(tx[f], `${p}.${f}`));",
              "",
              "        Object.entries(tx.recipient).forEach(([k, v]) => {",
              "            if (k !== \"updatedat\") {",
              "                expectNotNull(v, `${p}.recipient.${k}`);",
              "            }",
              "        });",
              "",
              "        if (tx.transactionCategory !== \"TOKEN_MINT\") {",
              "            Object.entries(tx.sender).forEach(([k, v]) => {",
              "                if (k !== \"updatedat\") {",
              "                    expectNotNull(v, `${p}.sender.${k}`);",
              "                }",
              "            });",
              "        }",
              "",
              "        expectNotNull(tx.fees.total, `${p}.fees.total`);",
              "    });",
              "",
              "    pm.test(`${p} fees calculation`, () => {",
              "        const base = Math.abs(num(tx.netTokenAmount));",
              "",
              "        if (tx.transactionCategory === \"TOKEN_MINT\") {",
              "            pm.expect(num(tx.fees.total)).to.equal(0);",
              "            pm.expect(tx.fees.burn).to.equal(null);",
              "            pm.expect(tx.fees.peer).to.equal(null);",
              "            pm.expect(tx.fees.inviter).to.equal(null);",
              "            return;",
              "        }",
              "",
              "        const hasInviter = tx.fees.inviter !== null;",
              "",
              "        expectPercent(",
              "            num(tx.fees.total),",
              "            base,",
              "            hasInviter ? 4 : 3,",
              "            `${p}.fees.total`",
              "        );",
              "",
              "        expectPercent(num(tx.fees.burn), base, 1, `${p}.fees.burn`);",
              "        expectPercent(num(tx.fees.peer), base, 2, `${p}.fees.peer`);",
              "",
              "        if (hasInviter) {",
              "            expectPercent(",
              "                num(tx.fees.inviter),",
              "                base,",
              "                1,",
              "                `${p}.fees.inviter`",
              "            );",
              "        }",
              "    });",
              "",
              "    pm.test(`${p} tokenamount by transactionCategory`, () => {",
              "        const token = Math.abs(num(tx.tokenamount));",
              "",
              "        switch (tx.transactionCategory) {",
              "            case \"LIKE\":",
              "            case \"DISLIKE\":",
              "                pm.expect(token).to.equal(3);",
              "                break;",
              "",
              "            case \"COMMENT\":",
              "                pm.expect(token).to.equal(1);",
              "                break;",
              "",
              "            case \"AD_PINNED\":",
              "                pm.expect(",
              "                    token === 160 || token % 50 === 0,",
              "                    `${p}.AD_PINNED token invalid: ${token} (expected 160 or multiple of 50)`",
              "                ).to.be.true;",
              "                break;",
              "",
              "            case \"POST_CREATE\":",
              "                pm.expect(token).to.equal(20);",
              "                break;",
              "",
              "            case \"P2P_TRANSFER\":",
              "                pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "                break;",
              "",
              "            case \"SHOP_PURCHASE\":",
              "                pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "                break;",
              "",
              "            case \"TOKEN_MINT\":",
              "                pm.expect(token, `${p}.TOKEN_MINT tokenamount must be > 0`).to.be.above(0);",
              "                pm.expect(",
              "                    num(tx.tokenamount),",
              "                    `${p}.TOKEN_MINT tokenamount must equal netTokenAmount`",
              "                ).to.equal(num(tx.netTokenAmount));",
              "                break;",
              "",
              "            default:",
              "                pm.test(`${p} transactionCategory is known`, () => {",
              "                    pm.expect.fail(`Unhandled transactionCategory: ${tx.transactionCategory}`);",
              "                });",
              "        }",
              "    });",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query TransactionHistory {\n    transactionHistory(limit: 1) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            operationid\n            transactionCategory\n            transactiontype\n            tokenamount\n            netTokenAmount\n            message\n            createdat\n            sender {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            recipient {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            fees {\n                total\n                burn\n                peer\n                inviter\n            }\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer decimal amount",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11211\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "const json = pm.response.json();",
              "",
              "const tokenAmount =",
              "    json?.data?.resolveTransferV2?.affectedRows?.tokensSubstractedFromWallet;",
              "",
              "pm.test(\"tokensSubstractedFromWallet exists\", () => {",
              "    pm.expect(tokenAmount).to.not.be.undefined;",
              "    pm.expect(tokenAmount).to.not.be.null;",
              "});",
              "",
              "pm.environment.set(\"tokenamount\", Number(tokenAmount));",
              "",
              "console.log(\"tokenamount set to:\", tokenAmount);"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{userid}}\", numberoftokens: 0.5, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Check current liquidity",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11204\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "let newLiquidity = response.data.balance.currentliquidity;",
              "let oldLiquidity = parseFloat(pm.environment.get(\"liquidity\"));",
              "pm.test(\"Previous liquidity exists\", function () {",
              "    pm.expect(oldLiquidity).to.be.a(\"number\");",
              "});",
              "let expectedDecrease = 0.52;",
              "let actualDecrease = oldLiquidity - newLiquidity;",
              "let tolerance = 0.1;",
              "pm.test(`Liquidity should decrease by approximately ${expectedDecrease} Â±${tolerance}`, function () {",
              "    pm.expect(actualDecrease).to.be.within(expectedDecrease - tolerance, expectedDecrease + tolerance);",
              "});",
              "pm.environment.set(\"liquidity\", newLiquidity);",
              "console.log(`Old Liquidity: ${oldLiquidity}, New Liquidity: ${newLiquidity}, Decreased by: ${actualDecrease}`);"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query Balance {\n    balance {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        currentliquidity\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transaction history",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"ResponseCode\":\"11215\"');",
              "});",
              "",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "const json = pm.response.json();",
              "const rows = json?.data?.transactionHistory?.affectedRows ?? [];",
              "",
              "pm.test(\"affectedRows is non-empty array\", () => {",
              "    pm.expect(rows).to.be.an(\"array\").that.is.not.empty;",
              "});",
              "",
              "const txid = rows[0]?.transactionId;",
              "if (txid) {",
              "    pm.environment.set(\"transactionid\", txid);",
              "}",
              "",
              "const opIdsToCheck = rows",
              "    .filter(tx => {",
              "        const token = Number(tx.tokenamount);",
              "",
              "        if (",
              "            (tx.transactionCategory === \"SHOP_PURCHASE\" || tx.transactionCategory === \"P2P_TRANSFER\")",
              "            && token > 0",
              "        ) {",
              "            return false;",
              "        }",
              "",
              "        return true;",
              "    })",
              "    .map(tx => tx.operationid);",
              "",
              "let prevOpIds = pm.environment.get(\"operationid\");",
              "prevOpIds = prevOpIds ? JSON.parse(prevOpIds) : [];",
              "",
              "const duplicates = opIdsToCheck.filter(id => prevOpIds.includes(id));",
              "",
              "pm.test(\"No duplicate operationid from previous request\", () => {",
              "    pm.expect(duplicates.length, `Duplicate operationid found: ${duplicates}`).to.equal(0);",
              "});",
              "",
              "const allOpIds = Array.from(new Set([...prevOpIds, ...opIdsToCheck]));",
              "pm.environment.set(\"operationid\", JSON.stringify(allOpIds));",
              "",
              "const P2P_EXPECTED_TOKEN = Number(pm.environment.get(\"tokenamount\"));",
              "const TOLERANCE = 0.0001;",
              "",
              "function num(v) {",
              "    return Number(v);",
              "}",
              "",
              "function expectNotNull(value, path) {",
              "    pm.expect(",
              "        value !== null && value !== undefined && value !== \"\",",
              "        `${path} is null/empty`",
              "    ).to.be.true;",
              "}",
              "",
              "function expectPercent(actual, base, percent, path) {",
              "    const expected = +(base * percent / 100).toFixed(6);",
              "    pm.expect(",
              "        actual,",
              "        `${path} expected ${percent}% (${expected}), got ${actual}`",
              "    ).to.be.closeTo(expected, TOLERANCE);",
              "}",
              "",
              "rows.forEach((tx, i) => {",
              "    const p = `affectedRows[${i}]`;",
              "",
              "    pm.test(`${p} mandatory fields not null`, () => {",
              "        [",
              "            \"operationid\",",
              "            \"transactionCategory\",",
              "            \"transactiontype\",",
              "            \"tokenamount\",",
              "            \"netTokenAmount\",",
              "            \"createdat\"",
              "        ].forEach(f => expectNotNull(tx[f], `${p}.${f}`));",
              "",
              "        Object.entries(tx.recipient).forEach(([k, v]) => {",
              "            if (k !== \"updatedat\") {",
              "                expectNotNull(v, `${p}.recipient.${k}`);",
              "            }",
              "        });",
              "",
              "        if (tx.transactionCategory !== \"TOKEN_MINT\") {",
              "            Object.entries(tx.sender).forEach(([k, v]) => {",
              "                if (k !== \"updatedat\") {",
              "                    expectNotNull(v, `${p}.sender.${k}`);",
              "                }",
              "            });",
              "        }",
              "",
              "        expectNotNull(tx.fees.total, `${p}.fees.total`);",
              "    });",
              "",
              "    pm.test(`${p} fees calculation`, () => {",
              "        const base = Math.abs(num(tx.netTokenAmount));",
              "",
              "        if (tx.transactionCategory === \"TOKEN_MINT\") {",
              "            pm.expect(num(tx.fees.total)).to.equal(0);",
              "            pm.expect(tx.fees.burn).to.equal(null);",
              "            pm.expect(tx.fees.peer).to.equal(null);",
              "            pm.expect(tx.fees.inviter).to.equal(null);",
              "            return;",
              "        }",
              "",
              "        const hasInviter = tx.fees.inviter !== null;",
              "",
              "        expectPercent(",
              "            num(tx.fees.total),",
              "            base,",
              "            hasInviter ? 4 : 3,",
              "            `${p}.fees.total`",
              "        );",
              "",
              "        expectPercent(num(tx.fees.burn), base, 1, `${p}.fees.burn`);",
              "        expectPercent(num(tx.fees.peer), base, 2, `${p}.fees.peer`);",
              "",
              "        if (hasInviter) {",
              "            expectPercent(",
              "                num(tx.fees.inviter),",
              "                base,",
              "                1,",
              "                `${p}.fees.inviter`",
              "            );",
              "        }",
              "    });",
              "",
              "    pm.test(`${p} tokenamount by transactionCategory`, () => {",
              "        const token = Math.abs(num(tx.tokenamount));",
              "",
              "        switch (tx.transactionCategory) {",
              "            case \"LIKE\":",
              "            case \"DISLIKE\":",
              "                pm.expect(token).to.equal(3);",
              "                break;",
              "",
              "            case \"COMMENT\":",
              "                pm.expect(token).to.equal(1);",
              "                break;",
              "",
              "            case \"AD_PINNED\":",
              "                pm.expect(",
              "                    token === 160 || token % 50 === 0,",
              "                    `${p}.AD_PINNED token invalid: ${token} (expected 160 or multiple of 50)`",
              "                ).to.be.true;",
              "                break;",
              "",
              "            case \"POST_CREATE\":",
              "                pm.expect(token).to.equal(20);",
              "                break;",
              "",
              "            case \"P2P_TRANSFER\":",
              "                pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "                break;",
              "",
              "            case \"SHOP_PURCHASE\":",
              "                pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "                break;",
              "",
              "            case \"TOKEN_MINT\":",
              "                pm.expect(token, `${p}.TOKEN_MINT tokenamount must be > 0`).to.be.above(0);",
              "                pm.expect(",
              "                    num(tx.tokenamount),",
              "                    `${p}.TOKEN_MINT tokenamount must equal netTokenAmount`",
              "                ).to.equal(num(tx.netTokenAmount));",
              "                break;",
              "",
              "            default:",
              "                pm.test(`${p} transactionCategory is known`, () => {",
              "                    pm.expect.fail(`Unhandled transactionCategory: ${tx.transactionCategory}`);",
              "                });",
              "        }",
              "    });",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query TransactionHistory {\n    transactionHistory(limit: 1) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            operationid\n            transactionCategory\n            transactiontype\n            tokenamount\n            netTokenAmount\n            message\n            createdat\n            sender {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            recipient {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            fees {\n                total\n                burn\n                peer\n                inviter\n            }\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get transaction history",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11215\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = {};",
              "try {",
              "    response = pm.response.json();",
              "} catch (e) {",
              "    console.log(\"Failed to parse JSON:\", e);",
              "}",
              "",
              "let transactions = response?.data?.getTransactionHistory?.affectedRows || [];",
              "",
              "let credit = transactions.find(tx => tx.transferaction === \"CREDIT\");",
              "",
              "pm.test(\"CREDIT transaction has correct message\", function () {",
              "    pm.expect(credit).to.not.be.undefined;",
              "    pm.expect(credit.message).to.eql(\"hi\");",
              "    pm.expect(credit?.tokenamount).to.eql(0.5);",
              "});",
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query GetTransactionHistory {\n    getTransactionHistory(limit: 5) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            transactionid\n            operationid\n            transactiontype\n            senderid\n            recipientid\n            tokenamount\n            transferaction\n            message\n            createdat\n        }\n    }\n}",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer token to yourself",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"31202\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t2}}\", numberoftokens: 5, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer token to invalid id",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"31007\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{uuid}}\", numberoftokens: 5, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer token to Peer",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"31203\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{peer}}\", numberoftokens: 5, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer token to Burn",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"31007\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{burn}}\", numberoftokens: 5, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer token to LP",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"31007\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{lp}}\", numberoftokens: 5, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer token to BTCP",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"31007\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{btc}}\", numberoftokens: 5, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer 0 token",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"30264\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t3}}\", numberoftokens: 0, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer negative amount",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"30264\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t3}}\", numberoftokens: -5, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer more than you have",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"51301\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});",
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t3}}\", numberoftokens: 100000, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer with too long message (fail)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"30270\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});",
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "let longMessage = \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. \".repeat(100);",
              "pm.environment.set(\"long_message\", longMessage);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t3}}\", numberoftokens: 10, message: \"{{long_message}}\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer with forbidden symbols (fail)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"30271\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});",
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t3}}\", numberoftokens: 10, message: \"A\\u00A0B\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer with a link (fail)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"30271\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});",
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t3}}\", numberoftokens: 10, message: \"https://frontend.getpeer.eu/login.php\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer more than 8 decimals (fail)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"30264\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});",
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t3}}\", numberoftokens: 1.123456789, message: \"\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer less than MIN_AMOUNT (fail)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"30264\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"error\"');",
              "});",
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "packages": {},
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t3}}\", numberoftokens: 0.000000001, message: \"\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Check current liquidity",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11204\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "let newLiquidity = response?.data?.balance?.currentliquidity;",
              "let oldLiquidity = Number(pm.environment.get(\"liquidity\"));",
              "",
              "console.log(`Old Liquidity: ${oldLiquidity}`);",
              "console.log(`New Liquidity: ${newLiquidity}`);",
              "",
              "pm.test(\"Previous liquidity exists\", function () {",
              "    pm.expect(oldLiquidity).to.be.a(\"number\");",
              "});",
              "",
              "pm.test(\"Liquidity should stay the same\", function () {",
              "    pm.expect(newLiquidity).to.equal(oldLiquidity, \"Expected liquidity to stay the same\");",
              "});",
              "",
              "pm.environment.set(\"liquidity\", newLiquidity);",
              "console.log(\"Updated liquidity in environment:\", newLiquidity);",
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query Balance {\n    balance {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        currentliquidity\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Call user move",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11205\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query ListTodaysInteractions {\n    listTodaysInteractions {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            totalInteractions\n            totalScore\n            totalDetails {\n                views\n                likes\n                dislikes\n                comments\n                viewsScore\n                likesScore\n                dislikesScore\n                commentsScore\n            }\n        }\n    }\n}",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get referral info",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11011\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query GetReferralInfo {\n    getReferralInfo {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        referralUuid\n        referralLink\n    }\n}",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get referral list",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11011\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "pm.test(\"ref tester exists\", function () {",
              "    pm.expect(pm.response.text()).to.include(pm.environment.get(\"userid\"));",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query ReferralList {\n    referralList(limit: 1) {\n        counter\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            invitedBy {\n                id\n                username\n                slug\n                img\n                isfollowed\n                isfollowing\n            }\n            iInvited {\n                id\n                username\n                slug\n                img\n                isfollowed\n                isfollowing\n            }\n        }\n    }\n}",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Login referred tester",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"10801\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "if (!pm.response.text().includes(\"error\")) {",
              "    pm.environment.set(\"accessToken\", response.data.login.accessToken);",
              "} else {",
              "    console.log(\"Error detected in response, environment variable not set.\");",
              "}",
              "if (!pm.response.text().includes(\"error\")) {",
              "    pm.environment.set(\"refreshToken\", response.data.login.refreshToken);",
              "} else {",
              "    console.log(\"Error detected in response, environment variable not set.\");",
              "}",
              "let token = pm.environment.get(\"accessToken\");",
              "pm.test(\"Access token exists\", function () {",
              "    pm.expect(token).to.be.a(\"string\");",
              "});",
              "",
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation {\n  login(email: \"{{random_email}}\", password: \"{{password}}\") {\n    meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n    accessToken\n    refreshToken\n  }\n}\n\n\n\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Check current liquidity",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11204\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "let liquidity = response.data.balance.currentliquidity;",
              "pm.environment.set(\"liquidity2\", liquidity);",
              "console.log(\"Saved liquidity:\", liquidity);"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query Balance {\n    balance {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        currentliquidity\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transaction history",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"ResponseCode\":\"11215\"');",
              "});",
              "",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "const json = pm.response.json();",
              "const rows = json?.data?.transactionHistory?.affectedRows ?? [];",
              "",
              "pm.test(\"affectedRows is non-empty array\", () => {",
              "    pm.expect(rows).to.be.an(\"array\").that.is.not.empty;",
              "});",
              "",
              "const txid = rows[0]?.transactionId;",
              "if (txid) {",
              "    pm.environment.set(\"transactionid\", txid);",
              "}",
              "",
              "const opIdsToCheck = rows",
              "    .filter(tx => {",
              "        const token = Number(tx.tokenamount);",
              "",
              "        if (",
              "            (tx.transactionCategory === \"SHOP_PURCHASE\" || tx.transactionCategory === \"P2P_TRANSFER\")",
              "            && token > 0",
              "        ) {",
              "            return false;",
              "        }",
              "",
              "        return true;",
              "    })",
              "    .map(tx => tx.operationid);",
              "",
              "let prevOpIds = pm.environment.get(\"operationid\");",
              "prevOpIds = prevOpIds ? JSON.parse(prevOpIds) : [];",
              "",
              "const duplicates = opIdsToCheck.filter(id => prevOpIds.includes(id));",
              "",
              "pm.test(\"No duplicate operationid from previous request\", () => {",
              "    pm.expect(duplicates.length, `Duplicate operationid found: ${duplicates}`).to.equal(0);",
              "});",
              "",
              "const allOpIds = Array.from(new Set([...prevOpIds, ...opIdsToCheck]));",
              "pm.environment.set(\"operationid\", JSON.stringify(allOpIds));",
              "",
              "const P2P_EXPECTED_TOKEN = Number(pm.environment.get(\"tokenamount\"));",
              "const TOLERANCE = 0.0001;",
              "",
              "function num(v) {",
              "    return Number(v);",
              "}",
              "",
              "function expectNotNull(value, path) {",
              "    pm.expect(",
              "        value !== null && value !== undefined && value !== \"\",",
              "        `${path} is null/empty`",
              "    ).to.be.true;",
              "}",
              "",
              "function expectPercent(actual, base, percent, path) {",
              "    const expected = +(base * percent / 100).toFixed(6);",
              "    pm.expect(",
              "        actual,",
              "        `${path} expected ${percent}% (${expected}), got ${actual}`",
              "    ).to.be.closeTo(expected, TOLERANCE);",
              "}",
              "",
              "rows.forEach((tx, i) => {",
              "    const p = `affectedRows[${i}]`;",
              "",
              "    pm.test(`${p} mandatory fields not null`, () => {",
              "        [",
              "            \"operationid\",",
              "            \"transactionCategory\",",
              "            \"transactiontype\",",
              "            \"tokenamount\",",
              "            \"netTokenAmount\",",
              "            \"createdat\"",
              "        ].forEach(f => expectNotNull(tx[f], `${p}.${f}`));",
              "",
              "        Object.entries(tx.recipient).forEach(([k, v]) => {",
              "            if (k !== \"updatedat\") {",
              "                expectNotNull(v, `${p}.recipient.${k}`);",
              "            }",
              "        });",
              "",
              "        if (tx.transactionCategory !== \"TOKEN_MINT\") {",
              "            Object.entries(tx.sender).forEach(([k, v]) => {",
              "                if (k !== \"updatedat\") {",
              "                    expectNotNull(v, `${p}.sender.${k}`);",
              "                }",
              "            });",
              "        }",
              "",
              "        expectNotNull(tx.fees.total, `${p}.fees.total`);",
              "    });",
              "",
              "    pm.test(`${p} fees calculation`, () => {",
              "        const base = Math.abs(num(tx.netTokenAmount));",
              "",
              "        if (tx.transactionCategory === \"TOKEN_MINT\") {",
              "            pm.expect(num(tx.fees.total)).to.equal(0);",
              "            pm.expect(tx.fees.burn).to.equal(null);",
              "            pm.expect(tx.fees.peer).to.equal(null);",
              "            pm.expect(tx.fees.inviter).to.equal(null);",
              "            return;",
              "        }",
              "",
              "        const hasInviter = tx.fees.inviter !== null;",
              "",
              "        expectPercent(",
              "            num(tx.fees.total),",
              "            base,",
              "            hasInviter ? 4 : 3,",
              "            `${p}.fees.total`",
              "        );",
              "",
              "        expectPercent(num(tx.fees.burn), base, 1, `${p}.fees.burn`);",
              "        expectPercent(num(tx.fees.peer), base, 2, `${p}.fees.peer`);",
              "",
              "        if (hasInviter) {",
              "            expectPercent(",
              "                num(tx.fees.inviter),",
              "                base,",
              "                1,",
              "                `${p}.fees.inviter`",
              "            );",
              "        }",
              "    });",
              "",
              "    pm.test(`${p} tokenamount by transactionCategory`, () => {",
              "        const token = Math.abs(num(tx.tokenamount));",
              "",
              "        switch (tx.transactionCategory) {",
              "            case \"LIKE\":",
              "            case \"DISLIKE\":",
              "                pm.expect(token).to.equal(3);",
              "                break;",
              "",
              "            case \"COMMENT\":",
              "                pm.expect(token).to.equal(1);",
              "                break;",
              "",
              "            case \"AD_PINNED\":",
              "                pm.expect(",
              "                    token === 160 || token % 50 === 0,",
              "                    `${p}.AD_PINNED token invalid: ${token} (expected 160 or multiple of 50)`",
              "                ).to.be.true;",
              "                break;",
              "",
              "            case \"POST_CREATE\":",
              "                pm.expect(token).to.equal(20);",
              "                break;",
              "",
              "            case \"P2P_TRANSFER\":",
              "                pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "                break;",
              "",
              "            case \"SHOP_PURCHASE\":",
              "                pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "                break;",
              "",
              "            case \"TOKEN_MINT\":",
              "                pm.expect(token, `${p}.TOKEN_MINT tokenamount must be > 0`).to.be.above(0);",
              "                pm.expect(",
              "                    num(tx.tokenamount),",
              "                    `${p}.TOKEN_MINT tokenamount must equal netTokenAmount`",
              "                ).to.equal(num(tx.netTokenAmount));",
              "                break;",
              "",
              "            default:",
              "                pm.test(`${p} transactionCategory is known`, () => {",
              "                    pm.expect.fail(`Unhandled transactionCategory: ${tx.transactionCategory}`);",
              "                });",
              "        }",
              "    });",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query TransactionHistory {\n    transactionHistory(limit: 1) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            operationid\n            transactionId\n            transactionCategory\n            transactiontype\n            tokenamount\n            netTokenAmount\n            message\n            createdat\n            sender {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            recipient {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            fees {\n                total\n                burn\n                peer\n                inviter\n            }\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get transaction history",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11215\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = {};",
              "try {",
              "    response = pm.response.json();",
              "} catch (e) {",
              "    console.log(\"Failed to parse JSON:\", e);",
              "}",
              "",
              "const transactions = response?.data?.getTransactionHistory?.affectedRows || [];",
              "",
              "const hasCredit0_5 = transactions.some(tx => ",
              "    tx.transferaction === \"CREDIT\" && tx.tokenamount === 0.5",
              ");",
              "",
              "const hasCredit115 = transactions.some(tx => ",
              "    tx.transferaction === \"CREDIT\" && tx.tokenamount === 160",
              ");",
              "",
              "pm.test(\"Contains CREDIT transaction with 0.5 tokens\", function () {",
              "    pm.expect(hasCredit0_5).to.be.true;",
              "});",
              "",
              "pm.test(\"Contains CREDIT transaction with 160 tokens\", function () {",
              "    pm.expect(hasCredit115).to.be.true;",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query GetTransactionHistory {\n    getTransactionHistory(limit: 2) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            transactionid\n            operationid\n            transactiontype\n            senderid\n            recipientid\n            tokenamount\n            transferaction\n            message\n            createdat\n        }\n    }\n}",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transfer token",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11211\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "const json = pm.response.json();",
              "",
              "const tokenAmount =",
              "    json?.data?.resolveTransferV2?.affectedRows?.tokensSubstractedFromWallet;",
              "",
              "pm.test(\"tokensSubstractedFromWallet exists\", () => {",
              "    pm.expect(tokenAmount).to.not.be.undefined;",
              "    pm.expect(tokenAmount).to.not.be.null;",
              "});",
              "",
              "pm.environment.set(\"tokenamount\", Number(tokenAmount));",
              "",
              "console.log(\"tokenamount set to:\", tokenAmount);"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation ResolveTransfer {\n    resolveTransferV2(recipient: \"{{w_userid_t3}}\", numberoftokens: 2, message: \"hi\") {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            tokenSend\n            tokensSubstractedFromWallet\n            createdat\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Check current liquidity",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11204\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "let newLiquidity = response.data.balance.currentliquidity;",
              "let oldLiquidity = parseFloat(pm.environment.get(\"liquidity2\"));",
              "pm.test(\"Previous liquidity exists\", function () {",
              "    pm.expect(oldLiquidity).to.be.a(\"number\");",
              "});",
              "let expectedDecrease = 2.1;",
              "let actualDecrease = oldLiquidity - newLiquidity;",
              "let tolerance = 0.1;",
              "pm.test(`Liquidity should decrease by approximately ${expectedDecrease} Â±${tolerance}`, function () {",
              "    pm.expect(actualDecrease).to.be.within(expectedDecrease - tolerance, expectedDecrease + tolerance);",
              "});",
              "pm.environment.set(\"liquidity2\", newLiquidity);",
              "console.log(`Old Liquidity: ${oldLiquidity}, New Liquidity: ${newLiquidity}, Decreased by: ${actualDecrease}`);"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query Balance {\n    balance {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        currentliquidity\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transaction history",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"ResponseCode\":\"11215\"');",
              "});",
              "",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "const json = pm.response.json();",
              "const rows = json?.data?.transactionHistory?.affectedRows ?? [];",
              "",
              "pm.test(\"affectedRows is non-empty array\", () => {",
              "    pm.expect(rows).to.be.an(\"array\").that.is.not.empty;",
              "});",
              "",
              "const txid = rows[0]?.transactionId;",
              "if (txid) {",
              "    pm.environment.set(\"transactionid\", txid);",
              "}",
              "",
              "const opIdsToCheck = rows",
              "    .filter(tx => {",
              "        const token = Number(tx.tokenamount);",
              "",
              "        if (",
              "            (tx.transactionCategory === \"SHOP_PURCHASE\" || tx.transactionCategory === \"P2P_TRANSFER\")",
              "            && token > 0",
              "        ) {",
              "            return false;",
              "        }",
              "",
              "        return true;",
              "    })",
              "    .map(tx => tx.operationid);",
              "",
              "let prevOpIds = pm.environment.get(\"operationid\");",
              "prevOpIds = prevOpIds ? JSON.parse(prevOpIds) : [];",
              "",
              "const duplicates = opIdsToCheck.filter(id => prevOpIds.includes(id));",
              "",
              "pm.test(\"No duplicate operationid from previous request\", () => {",
              "    pm.expect(duplicates.length, `Duplicate operationid found: ${duplicates}`).to.equal(0);",
              "});",
              "",
              "const allOpIds = Array.from(new Set([...prevOpIds, ...opIdsToCheck]));",
              "pm.environment.set(\"operationid\", JSON.stringify(allOpIds));",
              "",
              "const P2P_EXPECTED_TOKEN = Number(pm.environment.get(\"tokenamount\"));",
              "const TOLERANCE = 0.0001;",
              "",
              "function num(v) {",
              "    return Number(v);",
              "}",
              "",
              "function expectNotNull(value, path) {",
              "    pm.expect(",
              "        value !== null && value !== undefined && value !== \"\",",
              "        `${path} is null/empty`",
              "    ).to.be.true;",
              "}",
              "",
              "function expectPercent(actual, base, percent, path) {",
              "    const expected = +(base * percent / 100).toFixed(6);",
              "    pm.expect(",
              "        actual,",
              "        `${path} expected ${percent}% (${expected}), got ${actual}`",
              "    ).to.be.closeTo(expected, TOLERANCE);",
              "}",
              "",
              "rows.forEach((tx, i) => {",
              "    const p = `affectedRows[${i}]`;",
              "",
              "    pm.test(`${p} mandatory fields not null`, () => {",
              "        [",
              "            \"operationid\",",
              "            \"transactionCategory\",",
              "            \"transactiontype\",",
              "            \"tokenamount\",",
              "            \"netTokenAmount\",",
              "            \"createdat\"",
              "        ].forEach(f => expectNotNull(tx[f], `${p}.${f}`));",
              "",
              "        Object.entries(tx.recipient).forEach(([k, v]) => {",
              "            if (k !== \"updatedat\") {",
              "                expectNotNull(v, `${p}.recipient.${k}`);",
              "            }",
              "        });",
              "",
              "        if (tx.transactionCategory !== \"TOKEN_MINT\") {",
              "            Object.entries(tx.sender).forEach(([k, v]) => {",
              "                if (k !== \"updatedat\") {",
              "                    expectNotNull(v, `${p}.sender.${k}`);",
              "                }",
              "            });",
              "        }",
              "",
              "        expectNotNull(tx.fees.total, `${p}.fees.total`);",
              "    });",
              "",
              "    pm.test(`${p} fees calculation`, () => {",
              "        const base = Math.abs(num(tx.netTokenAmount));",
              "",
              "        if (tx.transactionCategory === \"TOKEN_MINT\") {",
              "            pm.expect(num(tx.fees.total)).to.equal(0);",
              "            pm.expect(tx.fees.burn).to.equal(null);",
              "            pm.expect(tx.fees.peer).to.equal(null);",
              "            pm.expect(tx.fees.inviter).to.equal(null);",
              "            return;",
              "        }",
              "",
              "        const hasInviter = tx.fees.inviter !== null;",
              "",
              "        expectPercent(",
              "            num(tx.fees.total),",
              "            base,",
              "            hasInviter ? 4 : 3,",
              "            `${p}.fees.total`",
              "        );",
              "",
              "        expectPercent(num(tx.fees.burn), base, 1, `${p}.fees.burn`);",
              "        expectPercent(num(tx.fees.peer), base, 2, `${p}.fees.peer`);",
              "",
              "        if (hasInviter) {",
              "            expectPercent(",
              "                num(tx.fees.inviter),",
              "                base,",
              "                1,",
              "                `${p}.fees.inviter`",
              "            );",
              "        }",
              "    });",
              "",
              "    pm.test(`${p} tokenamount by transactionCategory`, () => {",
              "        const token = Math.abs(num(tx.tokenamount));",
              "",
              "        switch (tx.transactionCategory) {",
              "            case \"LIKE\":",
              "            case \"DISLIKE\":",
              "                pm.expect(token).to.equal(3);",
              "                break;",
              "",
              "            case \"COMMENT\":",
              "                pm.expect(token).to.equal(1);",
              "                break;",
              "",
              "            case \"AD_PINNED\":",
              "                pm.expect(",
              "                    token === 160 || token % 50 === 0,",
              "                    `${p}.AD_PINNED token invalid: ${token} (expected 160 or multiple of 50)`",
              "                ).to.be.true;",
              "                break;",
              "",
              "            case \"POST_CREATE\":",
              "                pm.expect(token).to.equal(20);",
              "                break;",
              "",
              "            case \"P2P_TRANSFER\":",
              "                pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "                break;",
              "",
              "            case \"SHOP_PURCHASE\":",
              "                pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "                break;",
              "",
              "            case \"TOKEN_MINT\":",
              "                pm.expect(token, `${p}.TOKEN_MINT tokenamount must be > 0`).to.be.above(0);",
              "                pm.expect(",
              "                    num(tx.tokenamount),",
              "                    `${p}.TOKEN_MINT tokenamount must equal netTokenAmount`",
              "                ).to.equal(num(tx.netTokenAmount));",
              "                break;",
              "",
              "            default:",
              "                pm.test(`${p} transactionCategory is known`, () => {",
              "                    pm.expect.fail(`Unhandled transactionCategory: ${tx.transactionCategory}`);",
              "                });",
              "        }",
              "    });",
              "});"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query TransactionHistory {\n    transactionHistory(limit: 1) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            operationid\n            transactionCategory\n            transactiontype\n            tokenamount\n            netTokenAmount\n            message\n            createdat\n            sender {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            recipient {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            fees {\n                total\n                burn\n                peer\n                inviter\n            }\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get transaction history",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11215\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = {};",
              "try {",
              "    response = pm.response.json();",
              "} catch (e) {",
              "    console.log(\"Failed to parse JSON:\", e);",
              "}",
              "",
              "let transactions = response?.data?.getTransactionHistory?.affectedRows || [];",
              "",
              "let credit = transactions.find(tx => tx.transferaction === \"CREDIT\");",
              "let inviterFee = transactions.find(tx => tx.transferaction === \"INVITER_FEE\");",
              "",
              "pm.test(\"CREDIT transaction has correct message and amount\", function () {",
              "    pm.expect(credit).to.not.be.undefined;",
              "    pm.expect(credit.message).to.eql(\"hi\");",
              "    pm.expect(credit.tokenamount).to.eql(2);",
              "});",
              "",
              "pm.test(\"INVITER_FEE exists and amount is 0.02\", function () {",
              "    pm.expect(inviterFee).to.not.be.undefined;",
              "    pm.expect(inviterFee.tokenamount).to.eql(0.02);",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query GetTransactionHistory {\n    getTransactionHistory(limit: 6) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            transactionid\n            operationid\n            transactiontype\n            senderid\n            recipientid\n            tokenamount\n            transferaction\n            message\n            createdat\n        }\n    }\n}",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Login tester 2",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"10801\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "if (!pm.response.text().includes(\"error\")) {",
              "    pm.environment.set(\"accessToken\", response.data.login.accessToken);",
              "} else {",
              "    console.log(\"Error detected in response, environment variable not set.\");",
              "}",
              "if (!pm.response.text().includes(\"error\")) {",
              "    pm.environment.set(\"refreshToken\", response.data.login.refreshToken);",
              "} else {",
              "    console.log(\"Error detected in response, environment variable not set.\");",
              "}",
              "let token = pm.environment.get(\"accessToken\");",
              "pm.test(\"Access token exists\", function () {",
              "    pm.expect(token).to.be.a(\"string\");",
              "});",
              "",
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "mutation {\n  login(email: \"{{w_email_t2}}\",\n    password: \"{{w_password_t2}}\"\n  ) {\n    meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n    accessToken\n    refreshToken\n  }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Check current liquidity (ref%)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11204\");",
              "});",
              "",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = pm.response.json();",
              "let newLiquidity = response.data.balance.currentliquidity;",
              "let oldLiquidity = parseFloat(pm.environment.get(\"liquidity\"));",
              "pm.test(\"Previous liquidity exists\", function () {",
              "    pm.expect(oldLiquidity).to.be.a(\"number\");",
              "});",
              "let expectedDecrease = 0.02;",
              "let actualDecrease = newLiquidity - oldLiquidity;",
              "let tolerance = 0.1;",
              "pm.test(`Liquidity should increase by approximately ${expectedDecrease} Â±${tolerance}`, function () {",
              "    pm.expect(actualDecrease).to.be.within(expectedDecrease - tolerance, expectedDecrease + tolerance);",
              "});",
              "pm.environment.set(\"liquidity\", newLiquidity);",
              "console.log(`Old Liquidity: ${oldLiquidity}, New Liquidity: ${newLiquidity}, Decreased by: ${actualDecrease}`);"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query Balance {\n    balance {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        currentliquidity\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Transaction history (ref%)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// pm.test(\"ResponseCode is correct\", function () {",
              "//     pm.expect(pm.response.text()).to.include('\"ResponseCode\":\"11215\"');",
              "// });",
              "",
              "// pm.test(\"Status is correct\", function () {",
              "//     pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "// });",
              "",
              "// const json = pm.response.json();",
              "// const rows = json?.data?.transactionHistory?.affectedRows ?? [];",
              "",
              "// const currentOpIds = rows.map(tx => tx.operationid);",
              "",
              "// let prevOpIds = pm.environment.get(\"operationid\");",
              "// prevOpIds = prevOpIds ? JSON.parse(prevOpIds) : [];",
              "",
              "// const duplicates = currentOpIds.filter(id => prevOpIds.includes(id));",
              "",
              "// pm.test(\"No duplicate operationid from previous request\", () => {",
              "//     pm.expect(duplicates.length, `Duplicate operationid found: ${duplicates}`).to.equal(0);",
              "// });",
              "",
              "// const allOpIds = Array.from(new Set([...prevOpIds, ...currentOpIds]));",
              "// pm.environment.set(\"operationid\", JSON.stringify(allOpIds));",
              "",
              "// pm.test(\"affectedRows is non-empty array\", () => {",
              "//     pm.expect(rows).to.be.an(\"array\").that.is.not.empty;",
              "// });",
              "",
              "// const P2P_EXPECTED_TOKEN = Number(pm.environment.get(\"tokenamount\"));",
              "// const TOLERANCE = 0.0001;",
              "",
              "// function num(v) {",
              "//     return Number(v);",
              "// }",
              "",
              "// function expectNotNull(value, path) {",
              "//     pm.expect(",
              "//         value !== null && value !== undefined && value !== \"\",",
              "//         `${path} is null/empty`",
              "//     ).to.be.true;",
              "// }",
              "",
              "// function expectPercent(actual, base, percent, path) {",
              "//     const expected = +(base * percent / 100).toFixed(6);",
              "//     pm.expect(",
              "//         actual,",
              "//         `${path} expected ${percent}% (${expected}), got ${actual}`",
              "//     ).to.be.closeTo(expected, TOLERANCE);",
              "// }",
              "",
              "// rows.forEach((tx, i) => {",
              "//     const p = `affectedRows[${i}]`;",
              "",
              "//     pm.test(`${p} mandatory fields not null`, () => {",
              "//         [",
              "//             \"operationid\",",
              "//             \"transactionCategory\",",
              "//             \"transactiontype\",",
              "//             \"tokenamount\",",
              "//             \"netTokenAmount\",",
              "//             \"createdat\"",
              "//         ].forEach(f => expectNotNull(tx[f], `${p}.${f}`));",
              "",
              "//         [\"sender\", \"recipient\"].forEach(role => {",
              "//             Object.entries(tx[role]).forEach(([k, v]) => {",
              "//                 if (k !== \"updatedat\") {",
              "//                     expectNotNull(v, `${p}.${role}.${k}`);",
              "//                 }",
              "//             });",
              "//         });",
              "",
              "//         [\"total\", \"burn\", \"peer\"].forEach(f =>",
              "//             expectNotNull(tx.fees[f], `${p}.fees.${f}`)",
              "//         );",
              "//     });",
              "",
              "//     pm.test(`${p} fees calculation`, () => {",
              "//         const base = Math.abs(num(tx.netTokenAmount));",
              "//         const hasInviter = tx.fees.inviter !== null;",
              "",
              "//         expectPercent(",
              "//             num(tx.fees.total),",
              "//             base,",
              "//             hasInviter ? 4 : 3,",
              "//             `${p}.fees.total`",
              "//         );",
              "",
              "//         expectPercent(num(tx.fees.burn), base, 1, `${p}.fees.burn`);",
              "//         expectPercent(num(tx.fees.peer), base, 2, `${p}.fees.peer`);",
              "",
              "//         if (hasInviter) {",
              "//             expectPercent(",
              "//                 num(tx.fees.inviter),",
              "//                 base,",
              "//                 1,",
              "//                 `${p}.fees.inviter`",
              "//             );",
              "//         }",
              "//     });",
              "",
              "//     pm.test(`${p} tokenamount by transactionCategory`, () => {",
              "//         const token = Math.abs(num(tx.tokenamount));",
              "",
              "//         switch (tx.transactionCategory) {",
              "//             case \"LIKE\":",
              "//             case \"DISLIKE\":",
              "//                 pm.expect(token).to.equal(3);",
              "//                 break;",
              "",
              "//             case \"COMMENT\":",
              "//                 pm.expect(token).to.equal(1);",
              "//                 break;",
              "",
              "//             case \"AD_PINNED\":",
              "//                 pm.expect(",
              "//                     token === 160 || token % 50 === 0,",
              "//                     `${p}.AD_PINNED token invalid: ${token} (expected 160 or multiple of 50)`",
              "//                 ).to.be.true;",
              "//                 break;",
              "",
              "//             case \"POST_CREATE\":",
              "//                 pm.expect(token).to.equal(20);",
              "//                 break;",
              "",
              "//             case \"P2P_TRANSFER\":",
              "//                 pm.expect(token).to.equal(P2P_EXPECTED_TOKEN);",
              "//                 break;",
              "",
              "//             default:",
              "//                 console.warn(`Unhandled category: ${tx.transactionCategory}`);",
              "//         }",
              "//     });",
              "// });"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query TransactionHistory {\n    transactionHistory(limit: 1) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            operationid\n            transactionCategory\n            transactiontype\n            tokenamount\n            netTokenAmount\n            message\n            createdat\n            sender {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            recipient {\n                userid\n                img\n                username\n                slug\n                biography\n                visibilityStatus\n                isHiddenForUsers\n                hasActiveReports\n                updatedat\n            }\n            fees {\n                total\n                burn\n                peer\n                inviter\n            }\n        }\n    }\n}\n",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    },
    {
      "name": "Get transaction history",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"ResponseCode is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"11215\");",
              "});",
              "pm.test(\"Status is correct\", function () {",
              "    pm.expect(pm.response.text()).to.include('\"status\":\"success\"');",
              "});",
              "",
              "let response = {};",
              "try {",
              "    response = pm.response.json();",
              "} catch (e) {",
              "    console.error(\"Failed to parse response JSON:\", e);",
              "}",
              "",
              "let transactions = response?.data?.getTransactionHistory?.affectedRows || [];",
              "",
              "let inviterFeeTx = transactions.find(tx =>",
              "    tx.transferaction === \"INVITER_FEE\" &&",
              "    tx.tokenamount === 0.02",
              ");",
              "",
              "pm.test(\"Inviter fee transaction of 0.02 token exists\", function () {",
              "    pm.expect(inviterFeeTx).to.not.be.undefined;",
              "    pm.expect(inviterFeeTx.tokenamount).to.eql(0.02);",
              "    pm.expect(inviterFeeTx.transferaction).to.eql(\"INVITER_FEE\");",
              "});"
            ],
            "type": "text/javascript",
            "packages": {}
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              ""
            ],
            "type": "text/javascript",
            "packages": {}
          }
        }
      ],
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{accessToken}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "body": {
          "mode": "graphql",
          "graphql": {
            "query": "query GetTransactionHistory {\n    getTransactionHistory(limit: 1) {\n        meta {\n            status\n            RequestId\n            ResponseCode\n            ResponseMessage\n        }\n        affectedRows {\n            transactionid\n            operationid\n            transactiontype\n            senderid\n            recipientid\n            tokenamount\n            transferaction\n            message\n            createdat\n        }\n    }\n}",
            "variables": ""
          }
        },
        "url": {
          "raw": "{{test-backend}}/graphql",
          "host": [
            "{{test-backend}}"
          ],
          "path": [
            "graphql"
          ]
        }
      },
      "response": []
    }
  ]
}